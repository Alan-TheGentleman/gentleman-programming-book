name: Gentleman Guardian Angel

on:
  pull_request:
    types: [opened, synchronize]
    branches: [main, master]

jobs:
  code-review:
    name: AI Code Review
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2 # Need 2 commits for HEAD~1..HEAD diff

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Install GGA
        run: |
          curl -fsSL https://raw.githubusercontent.com/Gentleman-Programming/gentleman-guardian-angel/main/install.sh | bash
          echo "$HOME/.local/bin" >> $GITHUB_PATH

      - name: Install Gemini CLI
        run: npm install -g @google/gemini-cli

      - name: Run GGA Code Review
        run: gga run --ci
        env:
          GGA_PROVIDER: gemini
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
